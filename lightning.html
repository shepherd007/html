<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="512" height="512" style="border:1px solid #c3c3c3;">
Your browser does not support the HTML5 canvas tag.
</canvas>

<script>
    viewSizeX = 512;
    viewSizeY = 512;
    coeff = 20;

    var id;

   
	function generate(start, end, n) {
    
        var data = new Array(n);
        data[0] = start;
        data[n-1] = end;
        
		for(j=n-1; j>=2; j/=2)
		{
			for(i=0; i<n-1; i+=j)
			{
				ind1 = i;
				ind2 = i + j;
				
				pt1 = data[ind1];
				pt2 = data[ind2];
				
				// convert coordinates				
				newX = ((pt1 % viewSizeX) + (pt2 % viewSizeX)) /2;
				newY = ((pt1/viewSizeX) + (pt2/viewSizeX)) / 2;
				
				// add some random noise
				newX += (coeff * Math.random()) - (coeff/2);
				newY += (coeff * Math.random()) - (coeff/2);
				
				coeff /= 2;
				
				newX = Math.floor(newX);
				newY = Math.floor(newY);
				
				//convert back
				pt = (newY * viewSizeX) + newX;
				//var pt3 = Math.floor(((pt1 + pt2) / 4));// + (6 * Math.random()) - 3);
				
				data[Math.floor(i + j/2)] = pt;				
			}
		}
        
        return data;
	}
	
    function renderScene() {
        c = document.getElementById("myCanvas");
        ctx = c.getContext("2d");
        
        id = ctx.createImageData(viewSizeX,viewSizeY);
        
		coeff = 400;
		N = 4097;
        
        start = 0;
        end = viewSizeX*viewSizeY-1;
		
		//data = [start, 0, 0,0,0,0,0,0,end];
		data = generate(start,end, N);

		d  = id.data;
        ctx.moveTo(0,0);
		for(i=1;i<N-1;i++)
		{
		
            idx = 4 * data[i];
            d[idx] = 0;
            d[idx+1] = 0;
            d[idx+2] = 0;
            d[idx+3] = 255;
                        
            x= data[i+1] % viewSizeX;
            y= Math.floor(data[i+1] / viewSizeX);
            
            
            ctx.lineTo(x,y);
		}
		
            ctx.stroke();		        
      //  ctx.putImageData( id, 0, 0 );
    }


</script>

<button type="button" onclick="renderScene()">Try it</button>

</body>
</html>
